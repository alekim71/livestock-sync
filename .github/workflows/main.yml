name: Livestock Data Sync

on:
  schedule:
    # 한국시간 새벽 1시(UTC 16시)부터 30분마다 실행
    - cron: '0,30 16-23 * * *' 
    - cron: '0,30 0-15 * * *'  
  workflow_dispatch: # 수동 실행 버튼 유지

# concurrency는 on과 같은 레벨(바깥쪽)에 있어야 합니다.
concurrency:
  group: livestock-sync
  cancel-in-progress: false # 앞선 작업이 진행 중이면 취소하지 않고 대기하게 함

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          # requirements.txt가 없다면 직접 설치 명령어를 써도 됩니다.
          pip install requests xmltodict pymongo 

      - name: Run script
        env:
          MONGO_URI: ${{ secrets.MONGO_URI }}
          BASE44_KEY: ${{ secrets.BASE44_KEY }}
          EKAPE_KEY: ${{ secrets.EKAPE_KEY }}
          MTRACE_ID: ${{ secrets.MTRACE_ID }}
          MTRACE_KEY: ${{ secrets.MTRACE_KEY }}
          CNU_MTRACE_ID: ${{ secrets.CNU_MTRACE_ID }}
          CNU_MTRACE_KEY: ${{ secrets.CNU_MTRACE_KEY }}
        run: python main.py
